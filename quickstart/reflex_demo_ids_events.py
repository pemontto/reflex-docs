#!/usr/bin/env python3
"""This script ingests suricata-ids data for demo data"""
from encodings import utf_8
import argparse
import json
import uuid
from argparse import RawTextHelpFormatter
from opensearchpy import OpenSearch
from opensearchpy import helpers

parser = argparse.ArgumentParser(
    description='Used to import demo data',
    formatter_class=RawTextHelpFormatter
)
parser.add_argument(
    "--user",
    default="admin",
    type=str,
    help="OpenSearch user for authentication"
)
parser.add_argument(
    "--password",
    default="admin",
    type=str,
    help="Set to the password for OpenSearch"
)
parser.add_argument(
    "--host",
    default="localhost",
    type=str,
    help="OpenSearch host to query"
)
parser.add_argument(
    "--port",
    default=9200,
    type=int,
    help="OpenSearch port to connect to"
)
args = parser.parse_args()
admin = args.admin
password = args.password
host = args.host
port = args.port

auth = (admin, password)
client = OpenSearch(
    hosts = [{'host': host, 'port': port}],
    http_compress = True, # enables gzip compression for request bodies
    http_auth = auth,
    # client_cert = client_cert_path,
    # client_key = client_key_path,
    use_ssl = True,
    verify_certs = False,
    ssl_assert_hostname = False,
    ssl_show_warn = False,
)

# Create index template for suricata-ids
template = '{"version":1,"index_patterns":["suricata-ids*"],"priority":500,"data_stream":{},"template":{"settings":{},"mappings":{"_meta":{},"dynamic_templates":[{"message_field":{"path_match":"message","match_mapping_type":"string","mapping":{"norms":false,"type":"text"}}},{"string_fields":{"match":"*","match_mapping_type":"string","mapping":{"fields":{"keyword":{"ignore_above":256,"type":"keyword"}},"norms":false,"type":"text"}}}],"properties":{"@timestamp":{"type":"date"},"@version":{"type":"keyword"},"action":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"agent":{"properties":{"ephemeral_id":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"hostname":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"id":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"alert":{"properties":{"metadata":{"properties":{"affected_product":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"attack_target":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"created_at":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"cve":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"deployment":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"former_category":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"malware_family":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"performance_impact":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"signature_severity":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"tag":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"updated_at":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"rule":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"app_proto":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"app_proto_expected":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"app_proto_orig":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"app_proto_tc":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"app_proto_ts":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"bytes_to_client":{"type":"long"},"bytes_to_server":{"type":"long"},"category":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"certificate_common_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"certificate_not_valid_after":{"type":"date"},"certificate_not_valid_before":{"type":"date"},"certificate_serial_number":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"client_geo":{"dynamic":"true","properties":{"ip":{"type":"ip"},"latitude":{"type":"half_float"},"location":{"type":"geo_point"},"longitude":{"type":"half_float"}}},"client_geoip":{"dynamic":"true","properties":{"ip":{"type":"ip"},"latitude":{"type":"half_float"},"location":{"type":"geo_point"},"longitude":{"type":"half_float"}}},"community_id":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"destination":{"properties":{"ip":{"type":"ip"},"port":{"type":"long"}}},"destination_geo":{"dynamic":"true","properties":{"as_org":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"asn":{"type":"long"},"city_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"continent_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_code2":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_code3":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"dma_code":{"type":"long"},"ip":{"type":"ip"},"latitude":{"type":"half_float"},"location":{"type":"geo_point"},"longitude":{"type":"half_float"},"postal_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"region_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"region_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"timezone":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"destination_geoip":{"dynamic":"true","properties":{"ip":{"type":"ip"},"latitude":{"type":"half_float"},"location":{"type":"geo_point"},"longitude":{"type":"half_float"}}},"destination_ip":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"destination_ip_v6":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"destination_port":{"type":"long"},"dns":{"properties":{"aa":{"type":"boolean"},"answers":{"properties":{"rdata":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"rrname":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"rrtype":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"ttl":{"type":"long"}}},"authorities":{"properties":{"rdata":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"rrname":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"rrtype":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"ttl":{"type":"long"}}},"flags":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"grouped":{"properties":{"A":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"AAAA":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"CNAME":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"MX":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"PTR":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"TXT":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"qr":{"type":"boolean"},"query":{"properties":{"id":{"type":"long"},"rrname":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"rrtype":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"tx_id":{"type":"long"},"type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"ra":{"type":"boolean"},"rd":{"type":"boolean"},"tc":{"type":"boolean"},"tx_id":{"type":"long"},"version":{"type":"long"}}},"dns_id":{"type":"long"},"dns_type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"duration":{"type":"long"},"ecs":{"properties":{"version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"email":{"properties":{"attachment":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"cc":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"from":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"status":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"to":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"url":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"event":{"properties":{"created":{"type":"date"},"ingested":{"type":"date"}}},"event_type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"fileinfo":{"properties":{"filename":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"gaps":{"type":"boolean"},"magic":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"size":{"type":"long"},"state":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"stored":{"type":"boolean"},"tx_id":{"type":"long"}}},"files":{"properties":{"filename":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"gaps":{"type":"boolean"},"size":{"type":"long"},"state":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"stored":{"type":"boolean"},"tx_id":{"type":"long"}}},"flow":{"properties":{"wrong_thread":{"type":"boolean"}}},"flow_alerted":{"type":"boolean"},"flow_end":{"type":"date"},"flow_id":{"type":"long"},"flow_start":{"type":"date"},"geoip":{"dynamic":"true","properties":{"ip":{"type":"ip"},"latitude":{"type":"half_float"},"location":{"type":"geo_point"},"longitude":{"type":"half_float"}}},"gid":{"type":"long"},"host":{"properties":{"architecture":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"containerized":{"type":"boolean"},"hostname":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"id":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"ip":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"mac":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"os":{"properties":{"codename":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"family":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"kernel":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"platform":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}}}},"http":{"properties":{"hostname":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"http_content_type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"http_method":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"http_port":{"type":"long"},"http_refer":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"http_request_body_printable":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"http_response_body_printable":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"http_user_agent":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"length":{"type":"long"},"protocol":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"redirect":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"status":{"type":"long"},"url":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"xff":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"http_content_type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"http_payload_length":{"type":"long"},"http_version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"icmp_code":{"type":"long"},"icmp_type":{"type":"long"},"ikev2":{"properties":{"alg_auth":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"alg_dh":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"alg_enc":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"alg_esn":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"alg_prf":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"errors":{"type":"long"},"exchange_type":{"type":"long"},"init_spi":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"message_id":{"type":"long"},"notify":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"payload":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"resp_spi":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"role":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"version_major":{"type":"long"},"version_minor":{"type":"long"}}},"in_iface":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"input":{"properties":{"type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"ips":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"issuer_distinguished_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"log":{"properties":{"file":{"properties":{"path":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"offset":{"type":"long"}}},"log_event_type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"metadata":{"properties":{"flowbits":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"method":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"packet":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"packet_info":{"properties":{"linktype":{"type":"long"}}},"packets_to_client":{"type":"long"},"packets_to_server":{"type":"long"},"parent_id":{"type":"long"},"payload":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"payload_printable":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"proto":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"query":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"query_type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"reason":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"related":{"properties":{"ip":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"response_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"response_icmp_code":{"type":"long"},"response_icmp_type":{"type":"long"},"rev":{"type":"long"},"severity":{"type":"long"},"sid":{"type":"long"},"signature":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"smb":{"properties":{"access":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"accessed":{"type":"long"},"changed":{"type":"long"},"client_dialects":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"client_guid":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"command":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"created":{"type":"long"},"dcerpc":{"properties":{"call_id":{"type":"long"},"interfaces":{"properties":{"ack_reason":{"type":"long"},"ack_result":{"type":"long"},"uuid":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"opnum":{"type":"long"},"req":{"properties":{"frag_cnt":{"type":"long"},"stub_data_size":{"type":"long"}}},"request":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"res":{"properties":{"frag_cnt":{"type":"long"},"stub_data_size":{"type":"long"}}},"response":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"dialect":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"directory":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"disposition":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"filename":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"fuid":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"function":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"id":{"type":"long"},"kerberos":{"properties":{"realm":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"snames":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"modified":{"type":"long"},"named_pipe":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"ntlmssp":{"properties":{"domain":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"host":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"user":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"rename":{"properties":{"from":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"to":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"request":{"properties":{"native_lm":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"native_os":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"response":{"properties":{"native_lm":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"native_os":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"server_guid":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"service":{"properties":{"request":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"response":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"session_id":{"type":"long"},"set_info":{"properties":{"class":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"info_level":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"share":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"share_type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"size":{"type":"long"},"status":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"status_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"tree_id":{"type":"long"}}},"smtp":{"properties":{"helo":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"mail_from":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"rcpt_to":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"source":{"properties":{"as":{"properties":{"as_org":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"asn":{"type":"long"},"ip":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"geo":{"properties":{"city_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"continent_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_code2":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_code3":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"dma_code":{"type":"long"},"ip":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"latitude":{"type":"float"},"location":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"longitude":{"type":"float"},"postal_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"region_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"region_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"timezone":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"ip":{"type":"ip"},"port":{"type":"long"}}},"source_geo":{"dynamic":"true","properties":{"as_org":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"asn":{"type":"long"},"city_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"continent_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_code2":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_code3":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"country_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"dma_code":{"type":"long"},"ip":{"type":"ip"},"latitude":{"type":"half_float"},"location":{"type":"geo_point"},"longitude":{"type":"half_float"},"postal_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"region_code":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"region_name":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"timezone":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"source_geoip":{"dynamic":"true","properties":{"ip":{"type":"ip"},"latitude":{"type":"half_float"},"location":{"type":"geo_point"},"longitude":{"type":"half_float"}}},"source_ip":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"source_ip_v6":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"source_port":{"type":"long"},"ssh":{"properties":{"client":{"type":"object"},"server":{"type":"object"}}},"ssh_client_protocol_version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"ssh_client_software_version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"ssh_server_protocol_version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"ssh_server_software_version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"state":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"stats":{"properties":{"app_layer":{"properties":{"expectations":{"type":"long"},"flow":{"properties":{"dcerpc_tcp":{"type":"long"},"dcerpc_udp":{"type":"long"},"dns_tcp":{"type":"long"},"dns_udp":{"type":"long"},"failed_tcp":{"type":"long"},"failed_udp":{"type":"long"},"ftp":{"type":"long"},"ftp-data":{"type":"long"},"http":{"type":"long"},"ikev2":{"type":"long"},"imap":{"type":"long"},"msn":{"type":"long"},"smb":{"type":"long"},"smtp":{"type":"long"},"ssh":{"type":"long"},"tls":{"type":"long"}}},"tx":{"properties":{"dcerpc_tcp":{"type":"long"},"dcerpc_udp":{"type":"long"},"dns_tcp":{"type":"long"},"dns_udp":{"type":"long"},"ftp":{"type":"long"},"ftp-data":{"type":"long"},"http":{"type":"long"},"ikev2":{"type":"long"},"smb":{"type":"long"},"smtp":{"type":"long"},"ssh":{"type":"long"},"tls":{"type":"long"}}}}},"capture":{"properties":{"errors":{"type":"long"},"kernel_drops":{"type":"long"},"kernel_packets":{"type":"long"}}},"decoder":{"properties":{"avg_pkt_size":{"type":"long"},"bytes":{"type":"long"},"dce":{"properties":{"pkt_too_small":{"type":"long"}}},"erspan":{"type":"long"},"ethernet":{"type":"long"},"event":{"properties":{"erspan":{"properties":{"header_too_small":{"type":"long"},"too_many_vlan_layers":{"type":"long"},"unsupported_version":{"type":"long"}}},"ethernet":{"properties":{"pkt_too_small":{"type":"long"}}},"gre":{"properties":{"pkt_too_small":{"type":"long"},"version0_flags":{"type":"long"},"version0_hdr_too_big":{"type":"long"},"version0_malformed_sre_hdr":{"type":"long"},"version0_recur":{"type":"long"},"version1_chksum":{"type":"long"},"version1_flags":{"type":"long"},"version1_hdr_too_big":{"type":"long"},"version1_malformed_sre_hdr":{"type":"long"},"version1_no_key":{"type":"long"},"version1_recur":{"type":"long"},"version1_route":{"type":"long"},"version1_ssr":{"type":"long"},"version1_wrong_protocol":{"type":"long"},"wrong_version":{"type":"long"}}},"icmpv4":{"properties":{"ipv4_trunc_pkt":{"type":"long"},"ipv4_unknown_ver":{"type":"long"},"pkt_too_small":{"type":"long"},"unknown_code":{"type":"long"},"unknown_type":{"type":"long"}}},"icmpv6":{"properties":{"experimentation_type":{"type":"long"},"ipv6_trunc_pkt":{"type":"long"},"ipv6_unknown_version":{"type":"long"},"mld_message_with_invalid_hl":{"type":"long"},"pkt_too_small":{"type":"long"},"unassigned_type":{"type":"long"},"unknown_code":{"type":"long"},"unknown_type":{"type":"long"}}},"ieee8021ah":{"properties":{"header_too_small":{"type":"long"}}},"ipraw":{"properties":{"invalid_ip_version":{"type":"long"}}},"ipv4":{"properties":{"frag_ignored":{"type":"long"},"frag_overlap":{"type":"long"},"frag_pkt_too_large":{"type":"long"},"hlen_too_small":{"type":"long"},"icmpv6":{"type":"long"},"iplen_smaller_than_hlen":{"type":"long"},"opt_duplicate":{"type":"long"},"opt_eol_required":{"type":"long"},"opt_invalid":{"type":"long"},"opt_invalid_len":{"type":"long"},"opt_malformed":{"type":"long"},"opt_pad_required":{"type":"long"},"opt_unknown":{"type":"long"},"pkt_too_small":{"type":"long"},"trunc_pkt":{"type":"long"},"wrong_ip_version":{"type":"long"}}},"ipv6":{"properties":{"data_after_none_header":{"type":"long"},"dstopts_only_padding":{"type":"long"},"dstopts_unknown_opt":{"type":"long"},"exthdr_ah_res_not_null":{"type":"long"},"exthdr_dupl_ah":{"type":"long"},"exthdr_dupl_dh":{"type":"long"},"exthdr_dupl_eh":{"type":"long"},"exthdr_dupl_fh":{"type":"long"},"exthdr_dupl_hh":{"type":"long"},"exthdr_dupl_rh":{"type":"long"},"exthdr_invalid_optlen":{"type":"long"},"exthdr_useless_fh":{"type":"long"},"fh_non_zero_reserved_field":{"type":"long"},"frag_ignored":{"type":"long"},"frag_overlap":{"type":"long"},"frag_pkt_too_large":{"type":"long"},"hopopts_only_padding":{"type":"long"},"hopopts_unknown_opt":{"type":"long"},"icmpv4":{"type":"long"},"ipv4_in_ipv6_too_small":{"type":"long"},"ipv4_in_ipv6_wrong_version":{"type":"long"},"ipv6_in_ipv6_too_small":{"type":"long"},"ipv6_in_ipv6_wrong_version":{"type":"long"},"pkt_too_small":{"type":"long"},"rh_type_0":{"type":"long"},"trunc_exthdr":{"type":"long"},"trunc_pkt":{"type":"long"},"unknown_next_header":{"type":"long"},"wrong_ip_version":{"type":"long"},"zero_len_padn":{"type":"long"}}},"ltnull":{"properties":{"pkt_too_small":{"type":"long"},"unsupported_type":{"type":"long"}}},"mpls":{"properties":{"bad_label_implicit_null":{"type":"long"},"bad_label_reserved":{"type":"long"},"bad_label_router_alert":{"type":"long"},"header_too_small":{"type":"long"},"pkt_too_small":{"type":"long"},"unknown_payload_type":{"type":"long"}}},"ppp":{"properties":{"ip4_pkt_too_small":{"type":"long"},"ip6_pkt_too_small":{"type":"long"},"pkt_too_small":{"type":"long"},"unsup_proto":{"type":"long"},"vju_pkt_too_small":{"type":"long"},"wrong_type":{"type":"long"}}},"pppoe":{"properties":{"malformed_tags":{"type":"long"},"pkt_too_small":{"type":"long"},"wrong_code":{"type":"long"}}},"sctp":{"properties":{"pkt_too_small":{"type":"long"}}},"sll":{"properties":{"pkt_too_small":{"type":"long"}}},"tcp":{"properties":{"hlen_too_small":{"type":"long"},"invalid_optlen":{"type":"long"},"opt_duplicate":{"type":"long"},"opt_invalid_len":{"type":"long"},"pkt_too_small":{"type":"long"}}},"udp":{"properties":{"hlen_invalid":{"type":"long"},"hlen_too_small":{"type":"long"},"pkt_too_small":{"type":"long"}}},"vlan":{"properties":{"header_too_small":{"type":"long"},"too_many_layers":{"type":"long"},"unknown_type":{"type":"long"}}}}},"gre":{"type":"long"},"icmpv4":{"type":"long"},"icmpv6":{"type":"long"},"ieee8021ah":{"type":"long"},"invalid":{"type":"long"},"ipv4":{"type":"long"},"ipv4_in_ipv6":{"type":"long"},"ipv6":{"type":"long"},"ipv6_in_ipv6":{"type":"long"},"max_pkt_size":{"type":"long"},"mpls":{"type":"long"},"null":{"type":"long"},"pkts":{"type":"long"},"ppp":{"type":"long"},"pppoe":{"type":"long"},"raw":{"type":"long"},"sctp":{"type":"long"},"sll":{"type":"long"},"tcp":{"type":"long"},"teredo":{"type":"long"},"udp":{"type":"long"},"vlan":{"type":"long"},"vlan_qinq":{"type":"long"}}},"defrag":{"properties":{"ipv4":{"properties":{"fragments":{"type":"long"},"reassembled":{"type":"long"},"timeouts":{"type":"long"}}},"ipv6":{"properties":{"fragments":{"type":"long"},"reassembled":{"type":"long"},"timeouts":{"type":"long"}}},"max_frag_hits":{"type":"long"}}},"detect":{"properties":{"alert":{"type":"long"},"engines":{"properties":{"id":{"type":"long"},"last_reload":{"type":"date"},"rules_failed":{"type":"long"},"rules_loaded":{"type":"long"}}}}},"dns":{"properties":{"memcap_global":{"type":"long"},"memcap_state":{"type":"long"},"memuse":{"type":"long"}}},"flow":{"properties":{"emerg_mode_entered":{"type":"long"},"emerg_mode_over":{"type":"long"},"icmpv4":{"type":"long"},"icmpv6":{"type":"long"},"memcap":{"type":"long"},"memuse":{"type":"long"},"spare":{"type":"long"},"tcp":{"type":"long"},"tcp_reuse":{"type":"long"},"udp":{"type":"long"}}},"flow_mgr":{"properties":{"bypassed_pruned":{"type":"long"},"closed_pruned":{"type":"long"},"est_pruned":{"type":"long"},"flows_checked":{"type":"long"},"flows_notimeout":{"type":"long"},"flows_removed":{"type":"long"},"flows_timeout":{"type":"long"},"flows_timeout_inuse":{"type":"long"},"new_pruned":{"type":"long"},"rows_busy":{"type":"long"},"rows_checked":{"type":"long"},"rows_empty":{"type":"long"},"rows_maxlen":{"type":"long"},"rows_skipped":{"type":"long"}}},"ftp":{"properties":{"memcap":{"type":"long"},"memuse":{"type":"long"}}},"http":{"properties":{"memcap":{"type":"long"},"memuse":{"type":"long"}}},"tcp":{"properties":{"insert_data_normal_fail":{"type":"long"},"insert_data_overlap_fail":{"type":"long"},"insert_list_fail":{"type":"long"},"invalid_checksum":{"type":"long"},"memuse":{"type":"long"},"midstream_pickups":{"type":"long"},"no_flow":{"type":"long"},"overlap":{"type":"long"},"overlap_diff_data":{"type":"long"},"pkt_on_wrong_thread":{"type":"long"},"pseudo":{"type":"long"},"pseudo_failed":{"type":"long"},"reassembly_gap":{"type":"long"},"reassembly_memuse":{"type":"long"},"rst":{"type":"long"},"segment_memcap_drop":{"type":"long"},"sessions":{"type":"long"},"ssn_memcap_drop":{"type":"long"},"stream_depth_reached":{"type":"long"},"syn":{"type":"long"},"synack":{"type":"long"}}},"uptime":{"type":"long"}}},"status_message":{"type":"long"},"stream":{"type":"long"},"tags":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"tcp":{"properties":{"ack":{"type":"boolean"},"cwr":{"type":"boolean"},"ecn":{"type":"boolean"},"fin":{"type":"boolean"},"psh":{"type":"boolean"},"rst":{"type":"boolean"},"state":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"syn":{"type":"boolean"},"tcp_flags":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"tcp_flags_tc":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"tcp_flags_ts":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"tls":{"properties":{"from_proto":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"ja3":{"type":"object"},"serial":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"session_resumed":{"type":"boolean"},"sni":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"tls_version":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"transaction_id":{"type":"long"},"uri":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"useragent":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"virtual_host":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false},"vlan":{"type":"long"},"xff":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}},"norms":false}}},"aliases":{}}}'

# Load Suricata IDS index template into OpenSearch
client.indices.put_index_template("suricata-ids", body=template)


def get_data_from_file(ndjson_file):
    """Loads data from ndjson into an list

    Args:
        ndjson_file (string): File name to load ndjson contents

    Returns:
        list: List of JSON contents
    """
    data = []
    with open(ndjson_file, encoding=utf_8) as file:
        for line in file.readlines():
            record = {}
            record['_index'] = 'suricata-ids'
            record['_op_type'] = 'create'
            record['_id'] = uuid.uuid4()
            record['_source'] = json.loads(line.strip())
            data.append(record)
    return data

json_list = get_data_from_file("ids.ndjson")
response = helpers.bulk(client, json_list)
